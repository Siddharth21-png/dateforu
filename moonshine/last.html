<!DOCTYPE html>
<html lang="en">

<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Final Summary</title>

<style>
body{
  font-family: Courier;
  text-align:center;
  background:#fff5e4;
}

h2{
  color:#ff9494;
}

table{
  margin:auto;
  border-collapse:collapse;
  width:70%;
}

th,td{
  border:2px solid #ff9494;
  padding:12px;
}

th{
  background:#ffe3e1;
}

button{
  margin-top:20px;
  padding:10px 20px;
  font-size:16px;
  background:#ffe3e1;
  border:2px solid #ff9494;
  border-radius:10px;
  cursor:pointer;
}

button:hover{
  background:#ffd1cf;
}
</style>

<!-- EmailJS Library -->
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>

<script>
/* Initialize EmailJS */
(function(){
  emailjs.init({
    publicKey: "BfhEe_wxUxoRelAUC"
  });
})();
</script>

</head>

<body>

<h2>Your Date Plan ‚ù§Ô∏è</h2>

<table>
<tr>
<th>Date</th>
<th>Foods</th>
<th>Desserts</th>
<th>Activities</th>
</tr>

<tr>
<td id="date"></td>
<td id="foods"></td>
<td id="desserts"></td>
<td id="activities"></td>
</tr>
</table>

<button onclick="sendToAdmin()">Send to Admin</button>

<script>

/* ===============================
   LOAD SAVED DATA
================================ */

let date = localStorage.getItem("selectedDate");

let foods =
JSON.parse(localStorage.getItem("selectedFoods")) || [];

let desserts =
JSON.parse(localStorage.getItem("selectedDesserts")) || [];

let activities =
JSON.parse(localStorage.getItem("selectedActivities")) || [];


/* ===============================
   DISPLAY DATA IN TABLE
================================ */

document.getElementById("date").innerText =
date || "Not selected";

document.getElementById("foods").innerText =
foods.length ? foods.join(", ") : "None";

document.getElementById("desserts").innerText =
desserts.length ? desserts.join(", ") : "None";

document.getElementById("activities").innerText =
activities.length ? activities.join(", ") : "None";


/* ===============================
   SEND EMAIL + GO TO FINAL PAGE
================================ */

function sendToAdmin(){

emailjs.send(
  "service_9fwg9ns",
  "template_muf6add",
  {
    date: date || "Not selected",
    foods: foods.join(", "),
    desserts: desserts.join(", "),
    activities: activities.join(", ")
  }
)
.then(function(){

    alert("‚úÖ Plan sent to admin successfully!");

    // clear stored selections
    localStorage.clear();

    // redirect to flower ending page üå∏
    setTimeout(function(){
        window.location.href = "lastpage.html";
    }, 2000);

})
.catch(function(error){
    alert("‚ùå Email failed. Check console.");
    console.log(error);
});

}

</script>

</body>
</html>
