<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Music Player</title>
</head>
<body>

<!-- The audio element was missing! -->
<audio id="bgMusic" loop autoplay>
  <source src="music/lovesong.mp3" type="audio/mpeg">
</audio>

<script>
const music = document.getElementById("bgMusic");

// Restore previous playback time from localStorage
let savedTime = localStorage.getItem("musicTime");
if (savedTime) {
  music.currentTime = parseFloat(savedTime);
}

// Listen for play command from parent page
window.addEventListener("message", function(event) {
  if (event.data === 'play') {
    music.play().catch(e => console.log("Autoplay blocked, waiting for user interaction"));
  }
});

// Auto-play on load (may be blocked by browser)
music.play().catch(e => {
  console.log("Autoplay blocked, waiting for user interaction");
});

// Save playback position every second
setInterval(() => {
  if (!isNaN(music.currentTime)) {
    localStorage.setItem("musicTime", music.currentTime);
  }
}, 1000);
</script>

</body>
</html>